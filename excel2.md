# Лабораторная работа  
## «Комплексный анализ продаж: от загрузки данных до интерактивного дашборда»

---

### Вводная информация

В современном бизнесе умение быстро обрабатывать и анализировать данные становится ключевым навыком. Менеджеру, аналитику или руководителю ежедневно приходится работать с отчётами: сводить информацию из разных источников, проверять выполнение планов, выявлять лидеров и отстающих, прогнозировать результаты при изменении условий.

Microsoft Excel — основной инструмент для таких задач. Владение **продвинутыми приёмами** (связывание таблиц, многокритериальные расчёты, сводные таблицы со срезами, сценарный анализ) позволяет сократить время подготовки отчёта с нескольких часов до нескольких минут.

**Данная лабораторная работа моделирует реальную задачу:**  
У вас есть три разрозненных источника данных:
- журнал продаж (сотни записей);
- справочник менеджеров;
- помесячные планы продаж.

Вам необходимо объединить эти данные, обогатить журнал расчётными показателями, построить интерактивный дашборд для контроля выполнения плана, а также смоделировать влияние скидок на общую выручку.

**Цель работы:**  
Освоить на практике:
- вертикальный поиск и многокритериальное суммирование;
- «умные таблицы» и структурированные ссылки;
- создание сводных таблиц с вычисляемыми полями;
- настройку интерактивных фильтров (срезов);
- условное форматирование для визуализации результатов;
- инструмент «Таблица данных» для анализа чувствительности.

---

### Общее задание

1. **Подготовить исходные данные** — три взаимосвязанные таблицы на отдельных листах: «Продажи», «Менеджеры», «План». Оформить их как «умные таблицы».
2. **Обогатить таблицу «Продажи»**:
   - добавить ФИО и регион менеджера (функция ВПР/ПРОСМОТРX);
   - извлечь из даты месяц, год, квартал;
   - подтянуть плановое значение на соответствующий месяц (СУММЕСЛИМН);
   - рассчитать фактическую выручку менеджера за месяц и сравнить с планом (перевыполнен/не выполнен).
3. **Построить сводную таблицу** на листе «Дашборд»:
   - строки: регион → менеджер;
   - столбцы: квартал;
   - значения: сумма продаж, количество продаж, вычисляемое поле «Средний чек».
4. **Добавить интерактивность**:
   - два среза: по годам и по категориям товаров;
   - сводную диаграмму (гистограмму), связанную со срезами.
5. **Применить условное форматирование**:
   - цветовое выделение выполнения плана («светофор»);
   - гистограммы внутри сводной таблицы для сумм продаж.
6. **Выполнить однопараметрический анализ чувствительности**:
   - смоделировать изменение общей выручки в зависимости от процента скидки с помощью «Таблицы данных».

---

### Детальные шаги выполнения

#### Этап 1. Создание исходных таблиц

**1.1. Лист «Продажи»**  
Создайте таблицу со следующими столбцами (заголовки – в первой строке):

| Дата       | ID менеджера | Товар     | Категория   | Количество | Цена   | Сумма |
|------------|--------------|-----------|-------------|------------|--------|-------|
| 01.02.2023 | 3            | Ручка     | Канцелярия  | 10         | 45     | 450   |
| …          | …            | …         | …           | …          | …      | …     |

**Требования к данным:**
- **200+ строк**. Для быстрого заполнения сгенерируйте 10–15 строк, а затем скопируйте их много раз.
- **Дата** – используйте формулу `=СЛУЧМЕЖДУ(44927;45492)` и примените формат «Краткая дата» (01.01.2023 – 31.12.2024).
- **ID менеджера** – целые числа от 1 до 15 (повторяются случайно).
- **Товар и Категория** – придумайте 10–15 пар (например, Ноутбук/Электроника, Мышь/Электроника, Бумага/Канцелярия и т.п.).
- **Количество** – от 1 до 20 (целые).
- **Цена** – от 100 до 5000.
- **Сумма** – формула `=E2*F2`, протяните до конца таблицы.

После заполнения выделите всю таблицу с заголовками, нажмите **Ctrl+T** (или Вставка → Таблица).  
В открывшемся окне обязательно отметьте «Таблица с заголовками».  
На вкладке «Конструктор таблиц» задайте имя таблицы: **Продажи**.
!!!ВАЖНО!!!

---

**1.2. Лист «Менеджеры»**  
Создайте умную таблицу с полями:

| ID | ФИО           | Регион       | Дата найма |
|----|---------------|--------------|------------|
| 1  | Иванов И.И.   | Центр        | 15.03.2020 |
| 2  | Петрова П.П.  | Север-Запад  | 01.06.2019 |
| …  | …             | …            | …          |

- **ID** – уникальные номера (1,2,3… до 15).
- **ФИО** – произвольные.
- **Регион** – 3–5 регионов (Центр, Север-Запад, Юг, Волга, Урал).
- **Дата найма** – любые даты.

Назовите таблицу: **Менеджеры**.

---

**1.3. Лист «План»**  
Таблица с плановыми показателями:

| Год  | Месяц | ID менеджера | План (руб) |
|------|-------|--------------|------------|
| 2023 | 1     | 1            | 120000     |
| 2023 | 1     | 2            | 95000      |
| …    | …     | …            | …          |

- **Год** – 2023, 2024.
- **Месяц** – номер от 1 до 12.
- **ID менеджера** – повторяет ID из таблицы «Менеджеры».
- **План (руб)** – случайное число от 50 000 до 300 000.

Должны быть все комбинации годов, месяцев и менеджеров (всего 360 штук)
*Подсказка:* чтобы быстро сформировать все комбинации (Год × Месяц × ID), можно создать столбцы-помощники или просто перетащить данные. Главное, чтобы для каждого менеджера на каждый месяц был свой план.

Назовите таблицу: **План**.

---

#### Этап 2. Обогащение таблицы «Продажи»

Перейдите на лист «Продажи». Мы добавим несколько столбцов справа от существующих.

**2.1. ФИО и Регион менеджера (ВПР / ПРОСМОТРX)**  

- **Столбец H – ФИО менеджера**  
  Формула (для ячейки H2):  
  `=ВПР([@[ID менеджера]]; Менеджеры; 2; 0)`  
  **Как это работает:**  
  - `[@[ID менеджера]]` – обращение к значению в текущей строке столбца «ID менеджера» (структурированная ссылка умной таблицы).  
  - `Менеджеры` – имя таблицы-справочника.  
  - `2` – номер столбца в таблице «Менеджеры», из которого нужно вернуть значение (столбец «ФИО»).  
  - `0` – точное совпадение (обязательно!).

- **Столбец I – Регион**  
  `=ВПР([@[ID менеджера]]; Менеджеры; 3; 0)`

*Если у вас Excel 2021 или 365, можно использовать более гибкую функцию ПРОСМОТРX:*  
`=ПРОСМОТРX([@[ID менеджера]]; Менеджеры[ID]; Менеджеры[ФИО])`

Протяните формулы на весь столбец (Excel сделает это автоматически, если таблица «умная»).

---

**2.2. Месяц, Год, Квартал из даты**

- **Столбец J – Месяц:** `=МЕСЯЦ([@Дата])`
- **Столбец K – Год:** `=ГОД([@Дата])`
- **Столбец L – Квартал:** `=ЦЕЛОЕ((МЕСЯЦ([@Дата])+2)/3)`  
  *Пояснение:* формула преобразует номер месяца в номер квартала: (1+2)/3=1; (2+2)/3=1; … (12+2)/3=4. Более наглядно, чем вложенные ЕСЛИ.

---

**2.3. Подтягивание плановой суммы на месяц (СУММЕСЛИМН)**  

**Столбец M – План на месяц (руб).**  
Нам нужно найти в таблице «План» сумму, которая соответствует **году**, **месяцу** и **ID менеджера** из текущей строки.  

Формула:  
`=СУММЕСЛИМН(План[План (руб)]; План[Год]; [@Год]; План[Месяц]; [@Месяц]; План[ID менеджера]; [@[ID менеджера]])`

**Почему СУММЕСЛИМН, а не ВПР?**  
ВПР ищет только по одному условию, а здесь их три. СУММЕСЛИМН суммирует числа, удовлетворяющие нескольким условиям. Так как комбинация год+месяц+ID уникальна, сумма будет равна искомому плану.

---

**2.4. Фактическая выручка менеджера за месяц и сравнение с планом**

**Столбец N – Факт за месяц (руб).**  
Нужно просуммировать все продажи того же менеджера за тот же месяц и год.  

`=СУММЕСЛИМН(Продажи[Сумма]; Продажи[ID менеджера]; [@[ID менеджера]]; Продажи[Год]; [@Год]; Продажи[Месяц]; [@Месяц])`

*Обратите внимание:* в этом СУММЕСЛИМН диапазон суммирования – столбец «Сумма» из этой же таблицы «Продажи». Формула «пробежит» по всей таблице и соберёт все строки с нужным ID, годом, месяцем.

**Столбец O – Выполнение плана**  
`=ЕСЛИ([@[Факт за месяц]]>=[@[План на месяц]]; "Перевыполнен"; "Не выполнен")`

Теперь каждая строка продажи знает, был ли у данного менеджера в данном месяце перевыполнен план или нет.

---

#### Этап 3. Создание сводной таблицы (дашборд)

1. Перейдите на **новый лист**, назовите его **«Дашборд»**.
2. Выделите любую ячейку таблицы «Продажи» → **Вставка** → **Сводная таблица**.
3. Выберите «На новый лист» → ОК. Excel автоматически предложит поместить сводную таблицу на новый лист, но мы уже создали пустой лист «Дашборд». Можно указать его явно: в мастере выбрать «Имеющийся лист» и кликнуть на ячейку A1 листа «Дашборд».
4. Настройте поля сводной таблицы в области справа:
   - **Строки:** `Регион`, затем `ФИО менеджера`.
   - **Столбцы:** `Квартал`.
   - **Значения:** `Сумма` (Сумма), `Количество` (Количество).
5. **Добавьте вычисляемое поле «Средний чек»**:
   - Щёлкните внутри сводной таблицы → вкладка **Анализ сводной таблицы** → **Поля, элементы и наборы** → **Вычисляемое поле**.
   - Имя: `Средний чек`
   - Формула: `=Сумма/'Количество'` (Excel автоматически подставит имена полей в кавычках).
   - Нажмите «Добавить», затем «ОК».
   - Перетащите поле «Средний чек» в область «Значения» (можно поместить его рядом с суммой и количеством).
6. **Отформатируйте числа**:
   - Для полей «Сумма» и «План» – денежный формат.
   - Для «Средний чек» – тоже денежный или числовой с двумя знаками.
   - Для «Количество» – числовой без десятичных знаков.

---

#### Этап 4. Интерактивность: срезы и диаграмма

**4.1. Добавление срезов**
1. Выделите любую ячейку сводной таблицы.
2. Вкладка **Вставка** → **Срез**.
3. Выберите поля: **Год**, **Категория**.
4. Появятся два окна-среза. Отрегулируйте их размер, расположение, цвета (через контекстное меню → Параметры среза).

**4.2. Связывание срезов (если понадобится)**  
Обычно срез, созданный на основе сводной таблицы, автоматически управляет только ей. Но если мы добавим позже ещё одну сводную таблицу или диаграмму, их можно связать через **Отчёты связи** (правый клик на срезе → Отчёты связи).

**4.3. Сводная диаграмма**
1. Выделите сводную таблицу.
2. **Вставка** → **Гистограмма** (любой тип).
3. Диаграмма появится на листе. Теперь при изменении срезов (выборе года или категории) диаграмма будет автоматически перерисовываться.
4. Настройте заголовок, легенду, подписи данных по желанию.

---

#### Этап 5. Условное форматирование — визуализация результатов

**5.1. «Светофор» для выполнения плана**
1. В сводной таблице найдите столбец «Выполнение плана» (он должен присутствовать, если вы добавили его в область значений или строк).  
   *Если его нет в сводной таблице, перетащите поле «Выполнение плана» в область «Строки» или «Значения». Мы хотим видеть, как каждый менеджер выполняет план в разрезе кварталов. Удобнее поместить это поле в «Значения» и выбрать тип «Количество». Или просто вынести в «Строки» после ФИО.*
2. Выделите ячейки с текстом «Перевыполнен» / «Не выполнен».
3. **Главная** → **Условное форматирование** → **Правила выделения ячеек** → **Текст содержит**.
4. Введите «Перевыполнен», задайте зелёную заливку.
5. Повторите для «Не выполнен» – красная заливка.

**5.2. Гистограммы в ячейках для сумм продаж**
1. Выделите числовые значения поля «Сумма» в сводной таблице.
2. **Главная** → **Условное форматирование** → **Гистограммы** → выберите цвет заливки (например, синюю).
3. Теперь длина полосы пропорциональна сумме — сразу видно, кто продал больше.

---

#### Этап 6. Анализ «что-если»: влияние скидки на выручку

Предположим, мы хотим оценить, как изменится **общая выручка** компании при введении разных скидок на все товары. Это классическая задача **однопараметрического анализа**.

**6.1. Подготовка модели**
1. На листе «Дашборд» в свободной области (например, столбцы A–B) создайте:
   - В ячейку `A1` – текст **Скидка**.
   - В ячейку `B1` – **0%** (формат – процентный).
   - В ячейку `A2` – текст **Прогноз выручки**.
2. В ячейку `B2` введите формулу:  
   `=СУММ(Продажи[Сумма])*(1-B1)`  
   **Пояснение:** общая сумма продаж из таблицы «Продажи» умножается на (1 – скидка). Ячейка `B1` будет подстановочной.

**6.2. Создание таблицы данных**
1. В столбце **D** (начиная с D3) перечислите различные значения скидки:  
   `D3` – 0%, `D4` – 5%, `D5` – 10%, … до 50% (вниз).
2. В ячейку `E2` введите заголовок «Выручка».
3. В ячейку `E3` введите ссылку на формулу прогноза: `=B2`.
4. **Выделите диапазон** `D3:E13` (или до последней скидки).
5. Перейдите на вкладку **Данные** → **Анализ «что-если»** → **Таблица данных**.
6. В поле **«Подставлять значения по столбцам»** укажите ячейку `$B$1` (абсолютная ссылка на ячейку со скидкой).
   Поле «Подставлять значения по строкам» оставьте пустым.
7. Нажмите ОК.

Excel подставит каждое значение из столбца D в ячейку B1, пересчитает формулу из B2 и запишет результат в соседнюю ячейку столбца E.

**6.3. Проверка**  
Измените, например, количество продаж в исходной таблице — значения в таблице данных обновятся автоматически.  
Постройте простой график (вставка → точечная) для наглядной зависимости выручки от скидки.

---


